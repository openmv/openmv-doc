
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>class ADC – analog to digital conversion &#8212; MicroPython 1.19 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/customstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/openmv.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="class CAN – controller area network communication bus" href="pyb.CAN.html" />
    <link rel="prev" title="pyb — functions related to the board" href="pyb.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyb.CAN.html" title="class CAN – controller area network communication bus"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pyb.html" title="pyb — functions related to the board"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MicroPython 1.19 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >MicroPython libraries</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="pyb.html" accesskey="U"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyb</span></code> — functions related to the board</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="class-adc-analog-to-digital-conversion">
<span id="pyb-adc"></span><h1>class ADC – analog to digital conversion<a class="headerlink" href="#class-adc-analog-to-digital-conversion" title="Permalink to this headline">¶</a></h1>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyb</span>

<span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>                  <span class="c1"># create an analog object from a pin</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>                    <span class="c1"># read an analog value</span>

<span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADCAll</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>        <span class="c1"># create an ADCAll object</span>
<span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADCAll</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>  <span class="c1"># create an ADCAll object for selected analog channels</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>     <span class="c1"># read the given channel</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_temp</span><span class="p">()</span>          <span class="c1"># read MCU temperature</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_vbat</span><span class="p">()</span>          <span class="c1"># read MCU VBAT</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_vref</span><span class="p">()</span>          <span class="c1"># read MCU VREF</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_vref</span><span class="p">()</span>               <span class="c1"># read MCU supply voltage</span>
</pre></div>
</div>
<div class="section" id="constructors">
<h2>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyb.pyb.ADC">
<em class="property">class </em><code class="sig-prename descclassname">pyb.</code><code class="sig-name descname">ADC</code><span class="sig-paren">(</span><em class="sig-param">pin</em><span class="sig-paren">)</span><a class="headerlink" href="#pyb.pyb.ADC" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an ADC object associated with the given pin.
This allows you to then read analog values on that pin.</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="pyb.ADC.read">
<code class="sig-prename descclassname">ADC.</code><code class="sig-name descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyb.ADC.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the value on the analog pin and return it.  The returned value
will be between 0 and 4095.</p>
</dd></dl>

<dl class="method">
<dt id="pyb.ADC.read_timed">
<code class="sig-prename descclassname">ADC.</code><code class="sig-name descname">read_timed</code><span class="sig-paren">(</span><em class="sig-param">buf</em>, <em class="sig-param">timer</em><span class="sig-paren">)</span><a class="headerlink" href="#pyb.ADC.read_timed" title="Permalink to this definition">¶</a></dt>
<dd><p>Read analog values into <code class="docutils literal notranslate"><span class="pre">buf</span></code> at a rate set by the <code class="docutils literal notranslate"><span class="pre">timer</span></code> object.</p>
<p><code class="docutils literal notranslate"><span class="pre">buf</span></code> can be bytearray or array.array for example.  The ADC values have
12-bit resolution and are stored directly into <code class="docutils literal notranslate"><span class="pre">buf</span></code> if its element size is
16 bits or greater.  If <code class="docutils literal notranslate"><span class="pre">buf</span></code> has only 8-bit elements (eg a bytearray) then
the sample resolution will be reduced to 8 bits.</p>
<p><code class="docutils literal notranslate"><span class="pre">timer</span></code> should be a Timer object, and a sample is read each time the timer
triggers.  The timer must already be initialised and running at the desired
sampling frequency.</p>
<p>To support previous behaviour of this function, <code class="docutils literal notranslate"><span class="pre">timer</span></code> can also be an
integer which specifies the frequency (in Hz) to sample at.  In this case
Timer(6) will be automatically configured to run at the given frequency.</p>
<p>Example using a Timer object (preferred way):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="n">pyb</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;P5&quot;</span><span class="p">))</span>        <span class="c1"># create an ADC on pin P5</span>
<span class="n">tim</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>         <span class="c1"># create a timer running at 10Hz</span>
<span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>                <span class="c1"># creat a buffer to store the samples</span>
<span class="n">adc</span><span class="o">.</span><span class="n">read_timed</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tim</span><span class="p">)</span>            <span class="c1"># sample 100 values, taking 10s</span>
</pre></div>
</div>
<p>Example using an integer for the frequency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="n">pyb</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;P5&quot;</span><span class="p">))</span>        <span class="c1"># create an ADC on pin P5</span>
<span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>                <span class="c1"># create a buffer of 100 bytes</span>
<span class="n">adc</span><span class="o">.</span><span class="n">read_timed</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>             <span class="c1"># read analog values into buf at 10Hz</span>
                                    <span class="c1">#   this will take 10 seconds to finish</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">buf</span><span class="p">:</span>                     <span class="c1"># loop over all values</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>                      <span class="c1"># print the value out</span>
</pre></div>
</div>
<p>This function does not allocate any heap memory. It has blocking behaviour:
it does not return to the calling program until the buffer is full.</p>
</dd></dl>

</div>
<div class="section" id="the-adcall-object">
<h2>The ADCAll Object<a class="headerlink" href="#the-adcall-object" title="Permalink to this headline">¶</a></h2>
<p>Instantiating this changes all masked ADC pins to analog inputs. The preprocessed MCU temperature,
VREF and VBAT data can be accessed on ADC channels 16, 17 and 18 respectively.
Appropriate scaling is handled according to reference voltage used (usually 3.3V).
The temperature sensor on the chip is factory calibrated and allows to read the die temperature
to +/- 1 degree centigrade. Although this sounds pretty accurate, don’t forget that the MCU’s internal
temperature is measured. Depending on processing loads and I/O subsystems active the die temperature
may easily be tens of degrees above ambient temperature. On the other hand a pyboard woken up after a
long standby period will show correct ambient temperature within limits mentioned above.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ADCAll</span></code> <code class="docutils literal notranslate"><span class="pre">read_core_vbat()</span></code>, <code class="docutils literal notranslate"><span class="pre">read_vref()</span></code> and <code class="docutils literal notranslate"><span class="pre">read_core_vref()</span></code> methods read
the backup battery voltage, reference voltage and the (1.21V nominal) reference voltage using the
actual supply as a reference. All results are floating point numbers giving direct voltage values.</p>
<p><code class="docutils literal notranslate"><span class="pre">read_core_vbat()</span></code> returns the voltage of the backup battery. This voltage is also adjusted according
to the actual supply voltage. To avoid analog input overload the battery voltage is measured
via a voltage divider and scaled according to the divider value. To prevent excessive loads
to the backup battery, the voltage divider is only active during ADC conversion.</p>
<p><code class="docutils literal notranslate"><span class="pre">read_vref()</span></code> is evaluated by measuring the internal voltage reference and backscale it using
factory calibration value of the internal voltage reference. In most cases the reading would be close
to 3.3V. If the pyboard is operated from a battery, the supply voltage may drop to values below 3.3V.
The pyboard will still operate fine as long as the operating conditions are met. With proper settings
of MCU clock, flash access speed and programming mode it is possible to run the pyboard down to
2 V and still get useful ADC conversion.</p>
<p>It is very important to make sure analog input voltages never exceed actual supply voltage.</p>
<p>Other analog input channels (0..15) will return unscaled integer values according to the selected
precision.</p>
<p>To avoid unwanted activation of analog inputs (channel 0..15) a second parameter can be specified.
This parameter is a binary pattern where each requested analog input has the corresponding bit set.
The default value is 0xffffffff which means all analog inputs are active. If just the internal
channels (16..18) are required, the mask value should be 0x70000.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adcall</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADCAll</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mh">0x70000</span><span class="p">)</span> <span class="c1"># 12 bit resolution, internal channels</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">adcall</span><span class="o">.</span><span class="n">read_core_temp</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/web-logo-sticky.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">class ADC – analog to digital conversion</a><ul>
<li><a class="reference internal" href="#constructors">Constructors</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#the-adcall-object">The ADCAll Object</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pyb.html"
                        title="previous chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyb</span></code> — functions related to the board</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pyb.CAN.html"
                        title="next chapter">class CAN – controller area network communication bus</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/library/pyb.ADC.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pyb.CAN.html" title="class CAN – controller area network communication bus"
             >next</a> |</li>
        <li class="right" >
          <a href="pyb.html" title="pyb — functions related to the board"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MicroPython 1.19 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >MicroPython libraries</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="pyb.html" ><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyb</span></code> — functions related to the board</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright - The MicroPython Documentation is Copyright © 2014-2023, Damien P. George, Paul Sokolovsky, and contributors.
      Last updated on 02 May 2023.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>