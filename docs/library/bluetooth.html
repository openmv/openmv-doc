<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluetooth — low-level Bluetooth &mdash; MicroPython 1.20 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d5a28fe3" />
      <link rel="stylesheet" href="../_static/customstyle.css" type="text/css" />

  
    <link rel="shortcut icon" href="../_static/openmv.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=6b422e2e"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="btree – simple BTree database" href="btree.html" />
    <link rel="prev" title="_thread – multithreading support" href="_thread.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MicroPython
              <img src="../_static/web-logo-sticky.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.20
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MicroPython libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#python-standard-libraries-and-micro-libraries">Python standard libraries and micro-libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#micropython-specific-libraries">MicroPython-specific libraries</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bluetooth</span></code> — low-level Bluetooth</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#class-ble">class BLE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constructor">Constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-handling">Event Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcaster-role-advertiser">Broadcaster Role (Advertiser)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#observer-role-scanner">Observer Role (Scanner)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#central-role">Central Role</a></li>
<li class="toctree-l4"><a class="reference internal" href="#peripheral-role">Peripheral Role</a></li>
<li class="toctree-l4"><a class="reference internal" href="#central-peripheral-roles">Central &amp; Peripheral Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gatt-server">GATT Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gatt-client">GATT Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l2cap-connection-oriented-channels">L2CAP connection-oriented-channels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pairing-and-bonding">Pairing and bonding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#class-uuid">class UUID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Constructor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="btree.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">btree</span></code> – simple BTree database</a></li>
<li class="toctree-l3"><a class="reference internal" href="cryptolib.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cryptolib</span></code> – cryptographic ciphers</a></li>
<li class="toctree-l3"><a class="reference internal" href="framebuf.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">framebuf</span></code> — frame buffer manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="machine.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">machine</span></code> — functions related to the hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="micropython.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">micropython</span></code> – access and control MicroPython internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="neopixel.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neopixel</span></code> — control of WS2812 / NeoPixel LEDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="network.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">network</span></code> — network configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="uctypes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">uctypes</span></code> – access binary data in a structured way</a></li>
<li class="toctree-l3"><a class="reference internal" href="mutex.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mutex</span></code> — mutex module</a></li>
<li class="toctree-l3"><a class="reference internal" href="uping.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">uping</span></code> — Ping another computer</a></li>
<li class="toctree-l3"><a class="reference internal" href="urequests.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">urequests</span></code> — Related functions of HTTP client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#libraries-specific-to-the-openmv-cam">Libraries specific to the OpenMV Cam</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#third-party-libraries-on-the-openmv-cam">Third-party libraries on the OpenMV Cam</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extending-built-in-libraries-from-python">Extending built-in libraries from Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">MicroPython language and implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genrst/index.html">MicroPython differences from CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">MicroPython license information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openmvcam/quickref.html">Quick reference for the openmvcam</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MicroPython</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">MicroPython libraries</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bluetooth</span></code> — low-level Bluetooth</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/library/bluetooth.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-bluetooth">
<span id="bluetooth-low-level-bluetooth"></span><h1><a class="reference internal" href="#module-bluetooth" title="bluetooth: Low-level Bluetooth radio functionality"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bluetooth</span></code></a> — low-level Bluetooth<a class="headerlink" href="#module-bluetooth" title="Permalink to this heading">¶</a></h1>
<p>This module provides an interface to a Bluetooth controller on a board.
Currently this supports Bluetooth Low Energy (BLE) in Central, Peripheral,
Broadcaster, and Observer roles, as well as GATT Server and Client and L2CAP
connection-oriented-channels. A device may operate in multiple roles
concurrently. Pairing (and bonding) is supported on some ports.</p>
<p>This API is intended to match the low-level Bluetooth protocol and provide
building-blocks for higher-level abstractions such as specific device types.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For most applications, we recommend using the higher-level
<a class="reference external" href="https://github.com/micropython/micropython-lib/tree/master/micropython/bluetooth/aioble">aioble library</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module is still under development and its classes, functions,
methods and constants are subject to change.</p>
</div>
<section id="class-ble">
<h2>class BLE<a class="headerlink" href="#class-ble" title="Permalink to this heading">¶</a></h2>
</section>
<section id="constructor">
<h2>Constructor<a class="headerlink" href="#constructor" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="bluetooth.BLE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluetooth.</span></span><span class="sig-name descname"><span class="pre">BLE</span></span><a class="headerlink" href="#bluetooth.BLE" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the singleton BLE object.</p>
</dd></dl>

</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.active">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">active</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">active</span></span></em>, <span class="optional">]</span><em class="sig-param"><span class="n"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.active" title="Permalink to this definition">¶</a></dt>
<dd><p>Optionally changes the active state of the BLE radio, and returns the
current state.</p>
<p>The radio must be made active before using any other methods on this class.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.config">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">'param'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.config" title="Permalink to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param=value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get or set configuration values of the BLE interface.  To get a value the
parameter name should be quoted as a string, and just one parameter is
queried at a time.  To set values use the keyword syntax, and one ore more
parameter can be set at a time.</p>
<p>Currently supported values are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'mac'</span></code>: The current address in use, depending on the current address mode.
This returns a tuple of <code class="docutils literal notranslate"><span class="pre">(addr_type,</span> <span class="pre">addr)</span></code>.</p>
<p>See <a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a> for details about address type.</p>
<p>This may only be queried while the interface is currently active.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'addr_mode'</span></code>: Sets the address mode. Values can be:</p>
<blockquote>
<div><ul class="simple">
<li><p>0x00 - PUBLIC - Use the controller’s public address.</p></li>
<li><p>0x01 - RANDOM - Use a generated static address.</p></li>
<li><p>0x02 - RPA - Use resolvable private addresses.</p></li>
<li><p>0x03 - NRPA - Use non-resolvable private addresses.</p></li>
</ul>
</div></blockquote>
<p>By default the interface mode will use a PUBLIC address if available, otherwise
it will use a RANDOM address.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gap_name'</span></code>: Get/set the GAP device name used by service 0x1800,
characteristic 0x2a00.  This can be set at any time and changed multiple
times.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'rxbuf'</span></code>: Get/set the size in bytes of the internal buffer used to store
incoming events.  This buffer is global to the entire BLE driver and so
handles incoming data for all events, including all characteristics.
Increasing this allows better handling of bursty incoming data (for
example scan results) and the ability to receive larger characteristic values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'mtu'</span></code>: Get/set the MTU that will be used during a ATT MTU exchange. The
resulting MTU will be the minimum of this and the remote device’s MTU.
ATT MTU exchange will not happen automatically (unless the remote device initiates
it), and must be manually initiated with
<a class="reference internal" href="#bluetooth.BLE.gattc_exchange_mtu" title="bluetooth.BLE.gattc_exchange_mtu"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gattc_exchange_mtu</span></code></a>.
Use the <code class="docutils literal notranslate"><span class="pre">_IRQ_MTU_EXCHANGED</span></code> event to discover the MTU for a given connection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'bond'</span></code>: Sets whether bonding will be enabled during pairing. When
enabled, pairing requests will set the “bond” flag and the keys will be stored
by both devices.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'mitm'</span></code>: Sets whether MITM-protection is required for pairing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'io'</span></code>: Sets the I/O capabilities of this device.</p>
<p>Available options are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_IO_CAPABILITY_DISPLAY_ONLY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">_IO_CAPABILITY_DISPLAY_YESNO</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">_IO_CAPABILITY_KEYBOARD_ONLY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">_IO_CAPABILITY_NO_INPUT_OUTPUT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">_IO_CAPABILITY_KEYBOARD_DISPLAY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'le_secure'</span></code>: Sets whether “LE Secure” pairing is required. Default is
false (i.e. allow “Legacy Pairing”).</p></li>
</ul>
</dd></dl>

</section>
<section id="event-handling">
<h2>Event Handling<a class="headerlink" href="#event-handling" title="Permalink to this heading">¶</a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.irq">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">irq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.irq" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a callback for events from the BLE stack. The <em>handler</em> takes two
arguments, <code class="docutils literal notranslate"><span class="pre">event</span></code> (which will be one of the codes below) and <code class="docutils literal notranslate"><span class="pre">data</span></code>
(which is an event-specific tuple of values).</p>
<p><strong>Note:</strong> As an optimisation to prevent unnecessary allocations, the <code class="docutils literal notranslate"><span class="pre">addr</span></code>,
<code class="docutils literal notranslate"><span class="pre">adv_data</span></code>, <code class="docutils literal notranslate"><span class="pre">char_data</span></code>, <code class="docutils literal notranslate"><span class="pre">notify_data</span></code>, and <code class="docutils literal notranslate"><span class="pre">uuid</span></code> entries in the
tuples are read-only memoryview instances pointing to <a class="reference internal" href="#module-bluetooth" title="bluetooth: Low-level Bluetooth radio functionality"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bluetooth</span></code></a>’s internal
ringbuffer, and are only valid during the invocation of the IRQ handler
function.  If your program needs to save one of these values to access after
the IRQ handler has returned (e.g. by saving it in a class instance or global
variable), then it needs to take a copy of the data, either by using <code class="docutils literal notranslate"><span class="pre">bytes()</span></code>
or <code class="docutils literal notranslate"><span class="pre">bluetooth.UUID()</span></code>, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connected_addr</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>  <span class="c1"># equivalently: adv_data, char_data, or notify_data</span>
<span class="n">matched_uuid</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, the IRQ handler for a scan result might inspect the <code class="docutils literal notranslate"><span class="pre">adv_data</span></code>
to decide if it’s the correct device, and only then copy the address data to be
used elsewhere in the program.  And to print data from within the IRQ handler,
<code class="docutils literal notranslate"><span class="pre">print(bytes(addr))</span></code> will be needed.</p>
<p>An event handler showing all possible events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bt_irq</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_CENTRAL_CONNECT</span><span class="p">:</span>
        <span class="c1"># A central has connected to this peripheral.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_CENTRAL_DISCONNECT</span><span class="p">:</span>
        <span class="c1"># A central has disconnected from this peripheral.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTS_WRITE</span><span class="p">:</span>
        <span class="c1"># A client has written to this characteristic or descriptor.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">attr_handle</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTS_READ_REQUEST</span><span class="p">:</span>
        <span class="c1"># A client has issued a read. Note: this is only supported on STM32.</span>
        <span class="c1"># Return a non-zero integer to deny the read (see below), or zero (or None)</span>
        <span class="c1"># to accept the read.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">attr_handle</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_SCAN_RESULT</span><span class="p">:</span>
        <span class="c1"># A single scan result.</span>
        <span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">adv_type</span><span class="p">,</span> <span class="n">rssi</span><span class="p">,</span> <span class="n">adv_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_SCAN_DONE</span><span class="p">:</span>
        <span class="c1"># Scan duration finished or manually stopped.</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_PERIPHERAL_CONNECT</span><span class="p">:</span>
        <span class="c1"># A successful gap_connect().</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_PERIPHERAL_DISCONNECT</span><span class="p">:</span>
        <span class="c1"># Connected peripheral has disconnected.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">addr_type</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_SERVICE_RESULT</span><span class="p">:</span>
        <span class="c1"># Called for each service found by gattc_discover_services().</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">start_handle</span><span class="p">,</span> <span class="n">end_handle</span><span class="p">,</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_SERVICE_DONE</span><span class="p">:</span>
        <span class="c1"># Called once service discovery is complete.</span>
        <span class="c1"># Note: Status will be zero on success, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_CHARACTERISTIC_RESULT</span><span class="p">:</span>
        <span class="c1"># Called for each characteristic found by gattc_discover_services().</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">end_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_CHARACTERISTIC_DONE</span><span class="p">:</span>
        <span class="c1"># Called once service discovery is complete.</span>
        <span class="c1"># Note: Status will be zero on success, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_DESCRIPTOR_RESULT</span><span class="p">:</span>
        <span class="c1"># Called for each descriptor found by gattc_discover_descriptors().</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">dsc_handle</span><span class="p">,</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_DESCRIPTOR_DONE</span><span class="p">:</span>
        <span class="c1"># Called once service discovery is complete.</span>
        <span class="c1"># Note: Status will be zero on success, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_READ_RESULT</span><span class="p">:</span>
        <span class="c1"># A gattc_read() has completed.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">char_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_READ_DONE</span><span class="p">:</span>
        <span class="c1"># A gattc_read() has completed.</span>
        <span class="c1"># Note: Status will be zero on success, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_WRITE_DONE</span><span class="p">:</span>
        <span class="c1"># A gattc_write() has completed.</span>
        <span class="c1"># Note: Status will be zero on success, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_NOTIFY</span><span class="p">:</span>
        <span class="c1"># A server has sent a notify request.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">notify_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTC_INDICATE</span><span class="p">:</span>
        <span class="c1"># A server has sent an indicate request.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">notify_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GATTS_INDICATE_DONE</span><span class="p">:</span>
        <span class="c1"># A client has acknowledged the indication.</span>
        <span class="c1"># Note: Status will be zero on successful acknowledgment, implementation-specific value otherwise.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">value_handle</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_MTU_EXCHANGED</span><span class="p">:</span>
        <span class="c1"># ATT MTU exchange complete (either initiated by us or the remote device).</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">mtu</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_L2CAP_ACCEPT</span><span class="p">:</span>
        <span class="c1"># A new channel has been accepted.</span>
        <span class="c1"># Return a non-zero integer to reject the connection, or zero (or None) to accept.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">psm</span><span class="p">,</span> <span class="n">our_mtu</span><span class="p">,</span> <span class="n">peer_mtu</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_L2CAP_CONNECT</span><span class="p">:</span>
        <span class="c1"># A new channel is now connected (either as a result of connecting or accepting).</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">psm</span><span class="p">,</span> <span class="n">our_mtu</span><span class="p">,</span> <span class="n">peer_mtu</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_L2CAP_DISCONNECT</span><span class="p">:</span>
        <span class="c1"># Existing channel has disconnected (status is zero), or a connection attempt failed (non-zero status).</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">psm</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_L2CAP_RECV</span><span class="p">:</span>
        <span class="c1"># New data is available on the channel. Use l2cap_recvinto to read.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_L2CAP_SEND_READY</span><span class="p">:</span>
        <span class="c1"># A previous l2cap_send that returned False has now completed and the channel is ready to send again.</span>
        <span class="c1"># If status is non-zero, then the transmit buffer overflowed and the application should re-send the data.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_CONNECTION_UPDATE</span><span class="p">:</span>
        <span class="c1"># The remote device has updated connection parameters.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">conn_interval</span><span class="p">,</span> <span class="n">conn_latency</span><span class="p">,</span> <span class="n">supervision_timeout</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_ENCRYPTION_UPDATE</span><span class="p">:</span>
        <span class="c1"># The encryption state has changed (likely as a result of pairing or bonding).</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">,</span> <span class="n">authenticated</span><span class="p">,</span> <span class="n">bonded</span><span class="p">,</span> <span class="n">key_size</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_GET_SECRET</span><span class="p">:</span>
        <span class="c1"># Return a stored secret.</span>
        <span class="c1"># If key is None, return the index&#39;th value of this sec_type.</span>
        <span class="c1"># Otherwise return the corresponding value for this sec_type and key.</span>
        <span class="n">sec_type</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_SET_SECRET</span><span class="p">:</span>
        <span class="c1"># Save a secret to the store for this sec_type and key.</span>
        <span class="n">sec_type</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">_IRQ_PASSKEY_ACTION</span><span class="p">:</span>
        <span class="c1"># Respond to a passkey request during pairing.</span>
        <span class="c1"># See gap_passkey() for details.</span>
        <span class="c1"># action will be an action that is compatible with the configured &quot;io&quot; config.</span>
        <span class="c1"># passkey will be non-zero if action is &quot;numeric comparison&quot;.</span>
        <span class="n">conn_handle</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">passkey</span> <span class="o">=</span> <span class="n">data</span>
</pre></div>
</div>
</dd></dl>

<p>The event codes are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">micropython</span> <span class="kn">import</span> <span class="n">const</span>
<span class="n">_IRQ_CENTRAL_CONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">_IRQ_CENTRAL_DISCONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">_IRQ_GATTS_WRITE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">_IRQ_GATTS_READ_REQUEST</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">_IRQ_SCAN_RESULT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">_IRQ_SCAN_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">_IRQ_PERIPHERAL_CONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">_IRQ_PERIPHERAL_DISCONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_SERVICE_RESULT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_SERVICE_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_CHARACTERISTIC_RESULT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_CHARACTERISTIC_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_DESCRIPTOR_RESULT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_DESCRIPTOR_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_READ_RESULT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_READ_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_WRITE_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_NOTIFY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="n">_IRQ_GATTC_INDICATE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
<span class="n">_IRQ_GATTS_INDICATE_DONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">_IRQ_MTU_EXCHANGED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
<span class="n">_IRQ_L2CAP_ACCEPT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">_IRQ_L2CAP_CONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<span class="n">_IRQ_L2CAP_DISCONNECT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">_IRQ_L2CAP_RECV</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">_IRQ_L2CAP_SEND_READY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
<span class="n">_IRQ_CONNECTION_UPDATE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
<span class="n">_IRQ_ENCRYPTION_UPDATE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
<span class="n">_IRQ_GET_SECRET</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="n">_IRQ_SET_SECRET</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTS_READ_REQUEST</span></code> event, the available return codes are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_GATTS_NO_ERROR</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span>
<span class="n">_GATTS_ERROR_READ_NOT_PERMITTED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x02</span><span class="p">)</span>
<span class="n">_GATTS_ERROR_WRITE_NOT_PERMITTED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x03</span><span class="p">)</span>
<span class="n">_GATTS_ERROR_INSUFFICIENT_AUTHENTICATION</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x05</span><span class="p">)</span>
<span class="n">_GATTS_ERROR_INSUFFICIENT_AUTHORIZATION</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x08</span><span class="p">)</span>
<span class="n">_GATTS_ERROR_INSUFFICIENT_ENCRYPTION</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0f</span><span class="p">)</span>
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">_IRQ_PASSKEY_ACTION</span></code> event, the available actions are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_PASSKEY_ACTION_NONE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">_PASSKEY_ACTION_INPUT</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">_PASSKEY_ACTION_DISPLAY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">_PASSKEY_ACTION_NUMERIC_COMPARISON</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to save space in the firmware, these constants are not included on the
<a class="reference internal" href="#module-bluetooth" title="bluetooth: Low-level Bluetooth radio functionality"><code class="xref py py-mod docutils literal notranslate"><span class="pre">bluetooth</span></code></a> module. Add the ones that you need from the list above to your
program.</p>
</section>
<section id="broadcaster-role-advertiser">
<h2>Broadcaster Role (Advertiser)<a class="headerlink" href="#broadcaster-role-advertiser" title="Permalink to this heading">¶</a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_advertise">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_advertise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval_us</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adv_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resp_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connectable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_advertise" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts advertising at the specified interval (in <strong>micro</strong>seconds). This
interval will be rounded down to the nearest 625us. To stop advertising, set
<em>interval_us</em> to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p><em>adv_data</em> and <em>resp_data</em> can be any type that implements the buffer
protocol (e.g. <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">bytearray</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>). <em>adv_data</em> is included
in all broadcasts, and <em>resp_data</em> is send in reply to an active scan.</p>
<p><strong>Note:</strong> if <em>adv_data</em> (or <em>resp_data</em>) is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the data passed
to the previous call to <code class="docutils literal notranslate"><span class="pre">gap_advertise</span></code> will be re-used. This allows a
broadcaster to resume advertising with just <code class="docutils literal notranslate"><span class="pre">gap_advertise(interval_us)</span></code>.
To clear the advertising payload pass an empty <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">b''</span></code>.</p>
</dd></dl>

</section>
<section id="observer-role-scanner">
<h2>Observer Role (Scanner)<a class="headerlink" href="#observer-role-scanner" title="Permalink to this heading">¶</a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_scan">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_scan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">duration_ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval_us</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1280000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_us</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">11250</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">active</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_scan" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a scan operation lasting for the specified duration (in <strong>milli</strong>seconds).</p>
<p>To scan indefinitely, set <em>duration_ms</em> to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>To stop scanning, set <em>duration_ms</em> to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Use <em>interval_us</em> and <em>window_us</em> to optionally configure the duty cycle.
The scanner will run for <em>window_us</em> <strong>micro</strong>seconds every <em>interval_us</em>
<strong>micro</strong>seconds for a total of <em>duration_ms</em> <strong>milli</strong>seconds. The default
interval and window are 1.28 seconds and 11.25 milliseconds respectively
(background scanning).</p>
<p>For each scan result the <code class="docutils literal notranslate"><span class="pre">_IRQ_SCAN_RESULT</span></code> event will be raised, with event
data <code class="docutils literal notranslate"><span class="pre">(addr_type,</span> <span class="pre">addr,</span> <span class="pre">adv_type,</span> <span class="pre">rssi,</span> <span class="pre">adv_data)</span></code>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">addr_type</span></code> values indicate public or random addresses:</dt><dd><ul class="simple">
<li><p>0x00 - PUBLIC</p></li>
<li><p>0x01 - RANDOM (either static, RPA, or NRPA, the type is encoded in the address itself)</p></li>
</ul>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">adv_type</span></code> values correspond to the Bluetooth Specification:</p>
<blockquote>
<div><ul class="simple">
<li><p>0x00 - ADV_IND - connectable and scannable undirected advertising</p></li>
<li><p>0x01 - ADV_DIRECT_IND - connectable directed advertising</p></li>
<li><p>0x02 - ADV_SCAN_IND - scannable undirected advertising</p></li>
<li><p>0x03 - ADV_NONCONN_IND - non-connectable undirected advertising</p></li>
<li><p>0x04 - SCAN_RSP - scan response</p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">active</span></code> can be set <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want to receive scan responses in the results.</p>
<p>When scanning is stopped (either due to the duration finishing or when
explicitly stopped), the <code class="docutils literal notranslate"><span class="pre">_IRQ_SCAN_DONE</span></code> event will be raised.</p>
</dd></dl>

</section>
<section id="central-role">
<h2>Central Role<a class="headerlink" href="#central-role" title="Permalink to this heading">¶</a></h2>
<p>A central device can connect to peripherals that it has discovered using the observer role (see <a class="reference internal" href="#bluetooth.BLE.gap_scan" title="bluetooth.BLE.gap_scan"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gap_scan</span></code></a>) or with a known address.</p>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_connect">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_connect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">addr_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_duration_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_conn_interval_us</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_conn_interval_us</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to a peripheral.</p>
<p>See <a class="reference internal" href="#bluetooth.BLE.gap_scan" title="bluetooth.BLE.gap_scan"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gap_scan</span></code></a> for details about address types.</p>
<p>To cancel an outstanding connection attempt early, call
<code class="docutils literal notranslate"><span class="pre">gap_connect(None)</span></code>.</p>
<p>On success, the <code class="docutils literal notranslate"><span class="pre">_IRQ_PERIPHERAL_CONNECT</span></code> event will be raised. If
cancelling a connection attempt, the <code class="docutils literal notranslate"><span class="pre">_IRQ_PERIPHERAL_DISCONNECT</span></code> event
will be raised.</p>
<p>The device will wait up to <em>scan_duration_ms</em> to receive an advertising
payload from the device.</p>
<p>The connection interval can be configured in <strong>micro</strong>seconds using either
or both of <em>min_conn_interval_us</em> and <em>max_conn_interval_us</em>. Otherwise a
default interval will be chosen, typically between 30000 and 50000
microseconds. A shorter interval will increase throughput, at the expense
of power usage.</p>
</dd></dl>

</section>
<section id="peripheral-role">
<h2>Peripheral Role<a class="headerlink" href="#peripheral-role" title="Permalink to this heading">¶</a></h2>
<p>A peripheral device is expected to send connectable advertisements (see
<a class="reference internal" href="#bluetooth.BLE.gap_advertise" title="bluetooth.BLE.gap_advertise"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gap_advertise</span></code></a>). It will usually be acting as a GATT
server, having first registered services and characteristics using
<a class="reference internal" href="#bluetooth.BLE.gatts_register_services" title="bluetooth.BLE.gatts_register_services"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_register_services</span></code></a>.</p>
<p>When a central connects, the <code class="docutils literal notranslate"><span class="pre">_IRQ_CENTRAL_CONNECT</span></code> event will be raised.</p>
</section>
<section id="central-peripheral-roles">
<h2>Central &amp; Peripheral Roles<a class="headerlink" href="#central-peripheral-roles" title="Permalink to this heading">¶</a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_disconnect">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_disconnect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect the specified connection handle. This can either be a
central that has connected to this device (if acting as a peripheral)
or a peripheral that was previously connected to by this device (if acting
as a central).</p>
<p>On success, the <code class="docutils literal notranslate"><span class="pre">_IRQ_PERIPHERAL_DISCONNECT</span></code> or <code class="docutils literal notranslate"><span class="pre">_IRQ_CENTRAL_DISCONNECT</span></code>
event will be raised.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">False</span></code> if the connection handle wasn’t connected, and <code class="docutils literal notranslate"><span class="pre">True</span></code>
otherwise.</p>
</dd></dl>

</section>
<section id="gatt-server">
<h2>GATT Server<a class="headerlink" href="#gatt-server" title="Permalink to this heading">¶</a></h2>
<p>A GATT server has a set of registered services. Each service may contain
characteristics, which each have a value. Characteristics can also contain
descriptors, which themselves have values.</p>
<p>These values are stored locally, and are accessed by their “value handle” which
is generated during service registration. They can also be read from or written
to by a remote client device. Additionally, a server can “notify” a
characteristic to a connected client via a connection handle.</p>
<p>A device in either central or peripheral roles may function as a GATT server,
however in most cases it will be more common for a peripheral device to act
as the server.</p>
<p>Characteristics and descriptors have a default maximum size of 20 bytes.
Anything written to them by a client will be truncated to this length. However,
any local write will increase the maximum size, so if you want to allow larger
writes from a client to a given characteristic, use
<a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a> after registration. e.g.
<code class="docutils literal notranslate"><span class="pre">gatts_write(char_handle,</span> <span class="pre">bytes(100))</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_register_services">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_register_services</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">services_definition</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_register_services" title="Permalink to this definition">¶</a></dt>
<dd><p>Configures the server with the specified services, replacing any
existing services.</p>
<p><em>services_definition</em> is a list of <strong>services</strong>, where each <strong>service</strong> is a
two-element tuple containing a UUID and a list of <strong>characteristics</strong>.</p>
<p>Each <strong>characteristic</strong> is a two-or-three-element tuple containing a UUID, a
<strong>flags</strong> value, and optionally a list of <em>descriptors</em>.</p>
<p>Each <strong>descriptor</strong> is a two-element tuple containing a UUID and a <strong>flags</strong>
value.</p>
<p>The <strong>flags</strong> are a bitwise-OR combination of the flags defined below. These
set both the behaviour of the characteristic (or descriptor) as well as the
security and privacy requirements.</p>
<p>The return value is a list (one element per service) of tuples (each element
is a value handle). Characteristics and descriptor handles are flattened
into the same tuple, in the order that they are defined.</p>
<p>The following example registers two services (Heart Rate, and Nordic UART):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HR_UUID</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="mh">0x180D</span><span class="p">)</span>
<span class="n">HR_CHAR</span> <span class="o">=</span> <span class="p">(</span><span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="mh">0x2A37</span><span class="p">),</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">FLAG_READ</span> <span class="o">|</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">FLAG_NOTIFY</span><span class="p">,)</span>
<span class="n">HR_SERVICE</span> <span class="o">=</span> <span class="p">(</span><span class="n">HR_UUID</span><span class="p">,</span> <span class="p">(</span><span class="n">HR_CHAR</span><span class="p">,),)</span>
<span class="n">UART_UUID</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;6E400001-B5A3-F393-E0A9-E50E24DCCA9E&#39;</span><span class="p">)</span>
<span class="n">UART_TX</span> <span class="o">=</span> <span class="p">(</span><span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;6E400003-B5A3-F393-E0A9-E50E24DCCA9E&#39;</span><span class="p">),</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">FLAG_READ</span> <span class="o">|</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">FLAG_NOTIFY</span><span class="p">,)</span>
<span class="n">UART_RX</span> <span class="o">=</span> <span class="p">(</span><span class="n">bluetooth</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;6E400002-B5A3-F393-E0A9-E50E24DCCA9E&#39;</span><span class="p">),</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">FLAG_WRITE</span><span class="p">,)</span>
<span class="n">UART_SERVICE</span> <span class="o">=</span> <span class="p">(</span><span class="n">UART_UUID</span><span class="p">,</span> <span class="p">(</span><span class="n">UART_TX</span><span class="p">,</span> <span class="n">UART_RX</span><span class="p">,),)</span>
<span class="n">SERVICES</span> <span class="o">=</span> <span class="p">(</span><span class="n">HR_SERVICE</span><span class="p">,</span> <span class="n">UART_SERVICE</span><span class="p">,)</span>
<span class="p">(</span> <span class="p">(</span><span class="n">hr</span><span class="p">,),</span> <span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">rx</span><span class="p">,),</span> <span class="p">)</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">gatts_register_services</span><span class="p">(</span><span class="n">SERVICES</span><span class="p">)</span>
</pre></div>
</div>
<p>The three value handles (<code class="docutils literal notranslate"><span class="pre">hr</span></code>, <code class="docutils literal notranslate"><span class="pre">tx</span></code>, <code class="docutils literal notranslate"><span class="pre">rx</span></code>) can be used with
<a class="reference internal" href="#bluetooth.BLE.gatts_read" title="bluetooth.BLE.gatts_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_read</span></code></a>, <a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a>, <a class="reference internal" href="#bluetooth.BLE.gatts_notify" title="bluetooth.BLE.gatts_notify"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_notify</span></code></a>, and
<a class="reference internal" href="#bluetooth.BLE.gatts_indicate" title="bluetooth.BLE.gatts_indicate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_indicate</span></code></a>.</p>
<p><strong>Note:</strong> Advertising must be stopped before registering services.</p>
<p>Available flags for characteristics and descriptors are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">micropython</span> <span class="kn">import</span> <span class="n">const</span>
<span class="n">_FLAG_BROADCAST</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0001</span><span class="p">)</span>
<span class="n">_FLAG_READ</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0002</span><span class="p">)</span>
<span class="n">_FLAG_WRITE_NO_RESPONSE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0004</span><span class="p">)</span>
<span class="n">_FLAG_WRITE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0008</span><span class="p">)</span>
<span class="n">_FLAG_NOTIFY</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0010</span><span class="p">)</span>
<span class="n">_FLAG_INDICATE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0020</span><span class="p">)</span>
<span class="n">_FLAG_AUTHENTICATED_SIGNED_WRITE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0040</span><span class="p">)</span>

<span class="n">_FLAG_AUX_WRITE</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0100</span><span class="p">)</span>
<span class="n">_FLAG_READ_ENCRYPTED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0200</span><span class="p">)</span>
<span class="n">_FLAG_READ_AUTHENTICATED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0400</span><span class="p">)</span>
<span class="n">_FLAG_READ_AUTHORIZED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x0800</span><span class="p">)</span>
<span class="n">_FLAG_WRITE_ENCRYPTED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span>
<span class="n">_FLAG_WRITE_AUTHENTICATED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x2000</span><span class="p">)</span>
<span class="n">_FLAG_WRITE_AUTHORIZED</span> <span class="o">=</span> <span class="n">const</span><span class="p">(</span><span class="mh">0x4000</span><span class="p">)</span>
</pre></div>
</div>
<p>As for the IRQs above, any required constants should be added to your Python code.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_read">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the local value for this handle (which has either been written by
<a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a> or by a remote client).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_write">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">send_update</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the local value for this handle, which can be read by a client.</p>
<p>If <em>send_update</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then any subscribed clients will be notified
(or indicated, depending on what they’re subscribed to and which operations
the characteristic supports) about this write.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_notify">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_notify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a notification request to a connected client.</p>
<p>If <em>data</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), then the current local value (as set
with <a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a>) will be sent.</p>
<p>Otherwise, if <em>data</em> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, then that value is sent to the client
as part of the notification. The local value will not be modified.</p>
<p><strong>Note:</strong> The notification will be sent regardless of the subscription
status of the client to this characteristic.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_indicate">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_indicate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_indicate" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a indication request to a connected client.</p>
<p>If <em>data</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), then the current local value (as set
with <a class="reference internal" href="#bluetooth.BLE.gatts_write" title="bluetooth.BLE.gatts_write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_write</span></code></a>) will be sent.</p>
<p>Otherwise, if <em>data</em> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, then that value is sent to the client
as part of the indication. The local value will not be modified.</p>
<p>On acknowledgment (or failure, e.g. timeout), the
<code class="docutils literal notranslate"><span class="pre">_IRQ_GATTS_INDICATE_DONE</span></code> event will be raised.</p>
<p><strong>Note:</strong> The indication will be sent regardless of the subscription
status of the client to this characteristic.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gatts_set_buffer">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gatts_set_buffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">len</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gatts_set_buffer" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the internal buffer size for a value in bytes. This will limit the
largest possible write that can be received. The default is 20.</p>
<p>Setting <em>append</em> to <code class="docutils literal notranslate"><span class="pre">True</span></code> will make all remote writes append to, rather
than replace, the current value. At most <em>len</em> bytes can be buffered in
this way. When you use <a class="reference internal" href="#bluetooth.BLE.gatts_read" title="bluetooth.BLE.gatts_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gatts_read</span></code></a>, the value will
be cleared after reading. This feature is useful when implementing something
like the Nordic UART Service.</p>
</dd></dl>

</section>
<section id="gatt-client">
<h2>GATT Client<a class="headerlink" href="#gatt-client" title="Permalink to this heading">¶</a></h2>
<p>A GATT client can discover and read/write characteristics on a remote GATT server.</p>
<p>It is more common for a central role device to act as the GATT client, however
it’s also possible for a peripheral to act as a client in order to discover
information about the central that has connected to it (e.g. to read the
device name from the device information service).</p>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_discover_services">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_discover_services</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uuid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_discover_services" title="Permalink to this definition">¶</a></dt>
<dd><p>Query a connected server for its services.</p>
<p>Optionally specify a service <em>uuid</em> to query for that service only.</p>
<p>For each service discovered, the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_SERVICE_RESULT</span></code> event will
be raised, followed by <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_SERVICE_DONE</span></code> on completion.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_discover_characteristics">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_discover_characteristics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uuid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_discover_characteristics" title="Permalink to this definition">¶</a></dt>
<dd><p>Query a connected server for characteristics in the specified range.</p>
<p>Optionally specify a characteristic <em>uuid</em> to query for that
characteristic only.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">start_handle=1</span></code>, <code class="docutils literal notranslate"><span class="pre">end_handle=0xffff</span></code> to search for a
characteristic in any service.</p>
<p>For each characteristic discovered, the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_CHARACTERISTIC_RESULT</span></code>
event will be raised, followed by <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_CHARACTERISTIC_DONE</span></code> on completion.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_discover_descriptors">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_discover_descriptors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_discover_descriptors" title="Permalink to this definition">¶</a></dt>
<dd><p>Query a connected server for descriptors in the specified range.</p>
<p>For each descriptor discovered, the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_DESCRIPTOR_RESULT</span></code> event
will be raised, followed by <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_DESCRIPTOR_DONE</span></code> on completion.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_read">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a remote read to a connected server for the specified
characteristic or descriptor handle.</p>
<p>When a value is available, the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_READ_RESULT</span></code> event will be
raised. Additionally, the <code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_READ_DONE</span></code> will be raised.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_write">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a remote write to a connected server for the specified
characteristic or descriptor handle.</p>
<p>The argument <em>mode</em> specifies the write behaviour, with the currently
supported values being:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mode=0</span></code> (default) is a write-without-response: the write will
be sent to the remote server but no confirmation will be
returned, and no event will be raised.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode=1</span></code> is a write-with-response: the remote server is
requested to send a response/acknowledgement that it received the
data.</p></li>
</ul>
</div></blockquote>
<p>If a response is received from the remote server the
<code class="docutils literal notranslate"><span class="pre">_IRQ_GATTC_WRITE_DONE</span></code> event will be raised.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gattc_exchange_mtu">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gattc_exchange_mtu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gattc_exchange_mtu" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiate MTU exchange with a connected server, using the preferred MTU
set using <code class="docutils literal notranslate"><span class="pre">BLE.config(mtu=value)</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_IRQ_MTU_EXCHANGED</span></code> event will be raised when MTU exchange
completes.</p>
<p><strong>Note:</strong> MTU exchange is typically initiated by the central. When using
the BlueKitchen stack in the central role, it does not support a remote
peripheral initiating the MTU exchange. NimBLE works for both roles.</p>
</dd></dl>

</section>
<section id="l2cap-connection-oriented-channels">
<h2>L2CAP connection-oriented-channels<a class="headerlink" href="#l2cap-connection-oriented-channels" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>This feature allows for socket-like data exchange between two BLE devices.
Once the devices are connected via GAP, either device can listen for the
other to connect on a numeric PSM (Protocol/Service Multiplexer).</p>
<p><strong>Note:</strong> This is currently only supported when using the NimBLE stack on
STM32 and Unix (not ESP32). Only one L2CAP channel may be active at a given
time (i.e. you cannot connect while listening).</p>
<p>Active L2CAP channels are identified by the connection handle that they were
established on and a CID (channel ID).</p>
<p>Connection-oriented channels have built-in credit-based flow control. Unlike
ATT, where devices negotiate a shared MTU, both the listening and connecting
devices each set an independent MTU which limits the maximum amount of
outstanding data that the remote device can send before it is fully consumed
in <a class="reference internal" href="#bluetooth.BLE.l2cap_recvinto" title="bluetooth.BLE.l2cap_recvinto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">l2cap_recvinto</span></code></a>.</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.l2cap_listen">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">l2cap_listen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mtu</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.l2cap_listen" title="Permalink to this definition">¶</a></dt>
<dd><p>Start listening for incoming L2CAP channel requests on the specified <em>psm</em>
with the local MTU set to <em>mtu</em>.</p>
<p>When a remote device initiates a connection, the <code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_ACCEPT</span></code>
event will be raised, which gives the listening server a chance to reject
the incoming connection (by returning a non-zero integer).</p>
<p>Once the connection is accepted, the <code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_CONNECT</span></code> event will be
raised, allowing the server to obtain the channel id (CID) and the local and
remote MTU.</p>
<p><strong>Note:</strong> It is not currently possible to stop listening.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.l2cap_connect">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">l2cap_connect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mtu</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.l2cap_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to a listening peer on the specified <em>psm</em> with local MTU set to <em>mtu</em>.</p>
<p>On successful connection, the the <code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_CONNECT</span></code> event will be
raised, allowing the client to obtain the CID and the local and remote (peer) MTU.</p>
<p>An unsuccessful connection will raise the <code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_DISCONNECT</span></code> event
with a non-zero status.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.l2cap_disconnect">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">l2cap_disconnect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cid</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.l2cap_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect an active L2CAP channel with the specified <em>conn_handle</em> and
<em>cid</em>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.l2cap_send">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">l2cap_send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.l2cap_send" title="Permalink to this definition">¶</a></dt>
<dd><p>Send the specified <em>buf</em> (which must support the buffer protocol) on the
L2CAP channel identified by <em>conn_handle</em> and <em>cid</em>.</p>
<p>The specified buffer cannot be larger than the remote (peer) MTU, and no
more than twice the size of the local MTU.</p>
<p>This will return <code class="docutils literal notranslate"><span class="pre">False</span></code> if the channel is now “stalled”, which means that
<a class="reference internal" href="#bluetooth.BLE.l2cap_send" title="bluetooth.BLE.l2cap_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">l2cap_send</span></code></a> must not be called again until the
<code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_SEND_READY</span></code> event is received (which will happen when the
remote device grants more credits, typically after it has received and
processed the data).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.l2cap_recvinto">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">l2cap_recvinto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.l2cap_recvinto" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive data from the specified <em>conn_handle</em> and <em>cid</em> into the provided
<em>buf</em> (which must support the buffer protocol, e.g. bytearray or
memoryview).</p>
<p>Returns the number of bytes read from the channel.</p>
<p>If <em>buf</em> is None, then returns the number of bytes available.</p>
<p><strong>Note:</strong> After receiving the <code class="docutils literal notranslate"><span class="pre">_IRQ_L2CAP_RECV</span></code> event, the application should
continue calling <a class="reference internal" href="#bluetooth.BLE.l2cap_recvinto" title="bluetooth.BLE.l2cap_recvinto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">l2cap_recvinto</span></code></a> until no more
bytes are available in the receive buffer (typically up to the size of the
remote (peer) MTU).</p>
<p>Until the receive buffer is empty, the remote device will not be granted
more channel credits and will be unable to send any more data.</p>
</dd></dl>

</section>
<section id="pairing-and-bonding">
<h2>Pairing and bonding<a class="headerlink" href="#pairing-and-bonding" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>Pairing allows a connection to be encrypted and authenticated via exchange
of secrets (with optional MITM protection via passkey authentication).</p>
<p>Bonding is the process of storing those secrets into non-volatile storage.
When bonded, a device is able to resolve a resolvable private address (RPA)
from another device based on the stored identity resolving key (IRK).
To support bonding, an application must implement the <code class="docutils literal notranslate"><span class="pre">_IRQ_GET_SECRET</span></code>
and <code class="docutils literal notranslate"><span class="pre">_IRQ_SET_SECRET</span></code> events.</p>
<p><strong>Note:</strong> This is currently only supported when using the NimBLE stack on
STM32 and Unix (not ESP32).</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_pair">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_pair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_pair" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiate pairing with the remote device.</p>
<p>Before calling this, ensure that the <code class="docutils literal notranslate"><span class="pre">io</span></code>, <code class="docutils literal notranslate"><span class="pre">mitm</span></code>, <code class="docutils literal notranslate"><span class="pre">le_secure</span></code>, and
<code class="docutils literal notranslate"><span class="pre">bond</span></code> configuration options are set (via <a class="reference internal" href="#bluetooth.BLE.config" title="bluetooth.BLE.config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">config</span></code></a>).</p>
<p>On successful pairing, the <code class="docutils literal notranslate"><span class="pre">_IRQ_ENCRYPTION_UPDATE</span></code> event will be raised.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="bluetooth.BLE.gap_passkey">
<span class="sig-prename descclassname"><span class="pre">BLE.</span></span><span class="sig-name descname"><span class="pre">gap_passkey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn_handle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">passkey</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.BLE.gap_passkey" title="Permalink to this definition">¶</a></dt>
<dd><p>Respond to a <code class="docutils literal notranslate"><span class="pre">_IRQ_PASSKEY_ACTION</span></code> event for the specified <em>conn_handle</em>
and <em>action</em>.</p>
<p>The <em>passkey</em> is a numeric value and will depend on on the
<em>action</em> (which will depend on what I/O capability has been set):</p>
<blockquote>
<div><ul class="simple">
<li><p>When the <em>action</em> is <code class="docutils literal notranslate"><span class="pre">_PASSKEY_ACTION_INPUT</span></code>, then the application should
prompt the user to enter the passkey that is shown on the remote device.</p></li>
<li><p>When the <em>action</em> is <code class="docutils literal notranslate"><span class="pre">_PASSKEY_ACTION_DISPLAY</span></code>, then the application should
generate a random 6-digit passkey and show it to the user.</p></li>
<li><p>When the <em>action</em> is <code class="docutils literal notranslate"><span class="pre">_PASSKEY_ACTION_NUMERIC_COMPARISON</span></code>, then the application
should show the passkey that was provided in the <code class="docutils literal notranslate"><span class="pre">_IRQ_PASSKEY_ACTION</span></code> event
and then respond with either <code class="docutils literal notranslate"><span class="pre">0</span></code> (cancel pairing), or <code class="docutils literal notranslate"><span class="pre">1</span></code> (accept pairing).</p></li>
</ul>
</div></blockquote>
</dd></dl>

</section>
<section id="class-uuid">
<h2>class UUID<a class="headerlink" href="#class-uuid" title="Permalink to this heading">¶</a></h2>
</section>
<section id="id1">
<h2>Constructor<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="bluetooth.UUID">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">bluetooth.</span></span><span class="sig-name descname"><span class="pre">UUID</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#bluetooth.UUID" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a UUID instance with the specified <strong>value</strong>.</p>
<p>The <strong>value</strong> can be either:</p>
<ul class="simple">
<li><p>A 16-bit integer. e.g. <code class="docutils literal notranslate"><span class="pre">0x2908</span></code>.</p></li>
<li><p>A 128-bit UUID string. e.g. <code class="docutils literal notranslate"><span class="pre">'6E400001-B5A3-F393-E0A9-E50E24DCCA9E'</span></code>.</p></li>
</ul>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="_thread.html" class="btn btn-neutral float-left" title="_thread – multithreading support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="btree.html" class="btn btn-neutral float-right" title="btree – simple BTree database" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright - The MicroPython Documentation is Copyright © 2014-2023, Damien P. George, Paul Sokolovsky, and contributors.
      <span class="lastupdated">Last updated on 01 Dec 2023.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Language and External Links</span>
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Language</dt>
      <dd>
        <a href="https://openmv.io">English</a>
      </dd>
      <dd>
        <a href="http://doc.singtown.cc">中文</a>
      </dd>
    </dl>
    <hr/>
    <dl>
      <dt>External links</dt>
      <dd>
        <a href="https://openmv.io">openmv.io</a>
      </dd>
      <dd>
        <a href="http://forums.openmv.io">forums.openmv.io</a>
      </dd>
      <dd>
        <a href="https://github.com/openmv/openmv">github.com/openmv/openmv</a>
      </dd>
      <dd>
        <a href="http://micropython.org">micropython.org</a>
      </dd>
      <dd>
        <a href="http://forum.micropython.org">forum.micropython.org</a>
      </dd>
      <dd>
        <a href="https://github.com/micropython/micropython">github.com/micropython/micropython</a>
      </dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>