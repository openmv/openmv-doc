
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>class I2S – Inter-IC Sound bus protocol &#8212; MicroPython 1.19 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/customstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/openmv.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="class RTC – real time clock" href="machine.RTC.html" />
    <link rel="prev" title="class I2C – a two-wire serial protocol" href="machine.I2C.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="machine.RTC.html" title="class RTC – real time clock"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="machine.I2C.html" title="class I2C – a two-wire serial protocol"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MicroPython 1.19 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >MicroPython libraries</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="machine.html" accesskey="U"><code class="xref py py-mod docutils literal notranslate"><span class="pre">machine</span></code> — functions related to the hardware</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="class-i2s-inter-ic-sound-bus-protocol">
<span id="machine-i2s"></span><h1>class I2S – Inter-IC Sound bus protocol<a class="headerlink" href="#class-i2s-inter-ic-sound-bus-protocol" title="Permalink to this headline">¶</a></h1>
<p>I2S is a synchronous serial protocol used to connect digital audio devices.
At the physical level, a bus consists of 3 lines: SCK, WS, SD.
The I2S class supports controller operation.  Peripheral operation is not supported.</p>
<p>The I2S class is currently available as a Technical Preview.  During the preview period, feedback from
users is encouraged.  Based on this feedback, the I2S class API and implementation may be changed.</p>
<p>I2S objects can be created and initialized using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">I2S</span>
<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span>

<span class="c1"># ESP32</span>
<span class="n">sck_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>   <span class="c1"># Serial clock output</span>
<span class="n">ws_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>    <span class="c1"># Word clock output</span>
<span class="n">sd_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>    <span class="c1"># Serial data output</span>

<span class="ow">or</span>

<span class="c1"># PyBoards</span>
<span class="n">sck_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y6&quot;</span><span class="p">)</span>   <span class="c1"># Serial clock output</span>
<span class="n">ws_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y5&quot;</span><span class="p">)</span>    <span class="c1"># Word clock output</span>
<span class="n">sd_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y8&quot;</span><span class="p">)</span>    <span class="c1"># Serial data output</span>

<span class="n">audio_out</span> <span class="o">=</span> <span class="n">I2S</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">sck</span><span class="o">=</span><span class="n">sck_pin</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">ws_pin</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd_pin</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">TX</span><span class="p">,</span>
                <span class="n">bits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">MONO</span><span class="p">,</span>
                <span class="n">rate</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span>
                <span class="n">ibuf</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>

<span class="n">audio_in</span> <span class="o">=</span> <span class="n">I2S</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">sck</span><span class="o">=</span><span class="n">sck_pin</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">ws_pin</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd_pin</span><span class="p">,</span>
               <span class="n">mode</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">RX</span><span class="p">,</span>
               <span class="n">bits</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
               <span class="nb">format</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">STEREO</span><span class="p">,</span>
               <span class="n">rate</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
               <span class="n">ibuf</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>3 modes of operation are supported:</dt><dd><ul class="simple">
<li><p>blocking</p></li>
<li><p>non-blocking</p></li>
<li><p>uasyncio</p></li>
</ul>
</dd>
</dl>
<p>blocking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_written</span> <span class="o">=</span> <span class="n">audio_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># blocks until buf emptied</span>

<span class="n">num_read</span> <span class="o">=</span> <span class="n">audio_in</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># blocks until buf filled</span>
</pre></div>
</div>
<p>non-blocking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">audio_out</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">i2s_callback</span><span class="p">)</span>         <span class="c1"># i2s_callback is called when buf is emptied</span>
<span class="n">num_written</span> <span class="o">=</span> <span class="n">audio_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>  <span class="c1"># returns immediately</span>

<span class="n">audio_in</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">i2s_callback</span><span class="p">)</span>          <span class="c1"># i2s_callback is called when buf is filled</span>
<span class="n">num_read</span> <span class="o">=</span> <span class="n">audio_in</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>   <span class="c1"># returns immediately</span>
</pre></div>
</div>
<p>uasyncio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swriter</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="o">.</span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">audio_out</span><span class="p">)</span>
<span class="n">swriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="k">await</span> <span class="n">swriter</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>

<span class="n">sreader</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="o">.</span><span class="n">StreamReader</span><span class="p">(</span><span class="n">audio_in</span><span class="p">)</span>
<span class="n">num_read</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sreader</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="constructor">
<h2>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="machine.I2S">
<em class="property">class </em><code class="sig-prename descclassname">machine.</code><code class="sig-name descname">I2S</code><span class="sig-paren">(</span><em class="sig-param">id</em>, <em class="sig-param">*</em>, <em class="sig-param">sck</em>, <em class="sig-param">ws</em>, <em class="sig-param">sd</em>, <em class="sig-param">mck=None</em>, <em class="sig-param">mode</em>, <em class="sig-param">bits</em>, <em class="sig-param">format</em>, <em class="sig-param">rate</em>, <em class="sig-param">ibuf</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an I2S object of the given id:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> identifies a particular I2S bus; it is board and port specific</p></li>
</ul>
<p>Keyword-only parameters that are supported on all ports:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sck</span></code> is a pin object for the serial clock line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ws</span></code> is a pin object for the word select line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sd</span></code> is a pin object for the serial data line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mck</span></code> is a pin object for the master clock line;
master clock frequency is sampling rate * 256</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code> specifies receive or transmit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bits</span></code> specifies sample size (bits), 16 or 32</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code> specifies channel format, STEREO or MONO</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rate</span></code> specifies audio sampling rate (Hz);
this is the frequency of the <code class="docutils literal notranslate"><span class="pre">ws</span></code> signal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ibuf</span></code> specifies internal buffer length (bytes)</p></li>
</ul>
</div></blockquote>
<p>For all ports, DMA runs continuously in the background and allows user applications to perform other operations while
sample data is transfered between the internal buffer and the I2S peripheral unit.
Increasing the size of the internal buffer has the potential to increase the time that user applications can perform non-I2S operations
before underflow (e.g. <code class="docutils literal notranslate"><span class="pre">write</span></code> method) or overflow (e.g. <code class="docutils literal notranslate"><span class="pre">readinto</span></code> method).</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="machine.I2S.init">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">init</code><span class="sig-paren">(</span><em class="sig-param">sck</em>, <em class="sig-param">...</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.init" title="Permalink to this definition">¶</a></dt>
<dd><p>see Constructor for argument descriptions</p>
</dd></dl>

<dl class="method">
<dt id="machine.I2S.deinit">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">deinit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.deinit" title="Permalink to this definition">¶</a></dt>
<dd><p>Deinitialize the I2S bus</p>
</dd></dl>

<dl class="method">
<dt id="machine.I2S.readinto">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">readinto</code><span class="sig-paren">(</span><em class="sig-param">buf</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.readinto" title="Permalink to this definition">¶</a></dt>
<dd><p>Read audio samples into the buffer specified by <code class="docutils literal notranslate"><span class="pre">buf</span></code>.  <code class="docutils literal notranslate"><span class="pre">buf</span></code> must support the buffer protocol, such as bytearray or array.
“buf” byte ordering is little-endian.  For Stereo format, left channel sample precedes right channel sample. For Mono format,
the left channel sample data is used.
Returns number of bytes read</p>
</dd></dl>

<dl class="method">
<dt id="machine.I2S.write">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param">buf</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write audio samples contained in <code class="docutils literal notranslate"><span class="pre">buf</span></code>. <code class="docutils literal notranslate"><span class="pre">buf</span></code> must support the buffer protocol, such as bytearray or array.
“buf” byte ordering is little-endian.  For Stereo format, left channel sample precedes right channel sample. For Mono format,
the sample data is written to both the right and left channels.
Returns number of bytes written</p>
</dd></dl>

<dl class="method">
<dt id="machine.I2S.irq">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">irq</code><span class="sig-paren">(</span><em class="sig-param">handler</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.irq" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a callback. <code class="docutils literal notranslate"><span class="pre">handler</span></code> is called when <code class="docutils literal notranslate"><span class="pre">buf</span></code> is emptied (<code class="docutils literal notranslate"><span class="pre">write</span></code> method) or becomes full (<code class="docutils literal notranslate"><span class="pre">readinto</span></code> method).
Setting a callback changes the <code class="docutils literal notranslate"><span class="pre">write</span></code> and <code class="docutils literal notranslate"><span class="pre">readinto</span></code> methods to non-blocking operation.
<code class="docutils literal notranslate"><span class="pre">handler</span></code> is called in the context of the MicroPython scheduler.</p>
</dd></dl>

<dl class="method">
<dt id="machine.I2S.shift">
<em class="property">static </em><code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">shift</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">buf</em>, <em class="sig-param">bits</em>, <em class="sig-param">shift</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.shift" title="Permalink to this definition">¶</a></dt>
<dd><p>bitwise shift of all samples contained in <code class="docutils literal notranslate"><span class="pre">buf</span></code>. <code class="docutils literal notranslate"><span class="pre">bits</span></code> specifies sample size in bits. <code class="docutils literal notranslate"><span class="pre">shift</span></code> specifies the number of bits to shift each sample.
Positive for left shift, negative for right shift.
Typically used for volume control.  Each bit shift changes sample volume by 6dB.</p>
</dd></dl>

</div>
<div class="section" id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="machine.I2S.RX">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">RX</code><a class="headerlink" href="#machine.I2S.RX" title="Permalink to this definition">¶</a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">mode</span></code> to receive</p>
</dd></dl>

<dl class="data">
<dt id="machine.I2S.TX">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">TX</code><a class="headerlink" href="#machine.I2S.TX" title="Permalink to this definition">¶</a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">mode</span></code> to transmit</p>
</dd></dl>

<dl class="data">
<dt id="machine.I2S.STEREO">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">STEREO</code><a class="headerlink" href="#machine.I2S.STEREO" title="Permalink to this definition">¶</a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">format</span></code> to stereo</p>
</dd></dl>

<dl class="data">
<dt id="machine.I2S.MONO">
<code class="sig-prename descclassname">I2S.</code><code class="sig-name descname">MONO</code><a class="headerlink" href="#machine.I2S.MONO" title="Permalink to this definition">¶</a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">format</span></code> to mono</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/web-logo-sticky.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">class I2S – Inter-IC Sound bus protocol</a><ul>
<li><a class="reference internal" href="#constructor">Constructor</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="machine.I2C.html"
                        title="previous chapter">class I2C – a two-wire serial protocol</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="machine.RTC.html"
                        title="next chapter">class RTC – real time clock</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/library/machine.I2S.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="machine.RTC.html" title="class RTC – real time clock"
             >next</a> |</li>
        <li class="right" >
          <a href="machine.I2C.html" title="class I2C – a two-wire serial protocol"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MicroPython 1.19 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >MicroPython libraries</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="machine.html" ><code class="xref py py-mod docutils literal notranslate"><span class="pre">machine</span></code> — functions related to the hardware</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright - The MicroPython Documentation is Copyright © 2014-2023, Damien P. George, Paul Sokolovsky, and contributors.
      Last updated on 02 May 2023.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>